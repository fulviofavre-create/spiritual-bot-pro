<!doctype html>
<html lang="it">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Consulenze Spirituali â€“ Debug</title>
<body style="font-family:system-ui;max-width:820px;margin:2rem auto;padding:0 1rem">
  <h1>ðŸ”® Consulenze Spirituali (Debug)</h1>
  <div id="chat" style="border:1px solid #ddd;border-radius:10px;padding:1rem;height:320px;overflow:auto;white-space:pre-wrap"></div>
  <div style="margin-top:.5rem">
    <input id="q" placeholder="Scrivi la tua domanda..." style="width:70%;padding:.5rem">
    <button id="send">Invia</button>
  </div>
  <p id="error" style="color:#b00020"></p>

  <h3>ðŸ§ª Test di salute</h3>
  <p>Apri <code>/api/health</code> per vedere se la chiave c'Ã¨.</p>
  <button id="health">Esegui /api/health</button>
  <pre id="out" style="background:#111;color:#eee;padding:1rem;border-radius:8px;overflow:auto;max-height:220px"></pre>

<script>
const chat = document.getElementById('chat');
const error = document.getElementById('error');
document.getElementById('send').onclick = async () => {
  error.textContent = "";
  const q = document.getElementById('q').value.trim();
  if(!q) return;
  chat.textContent += "\nTu: " + q;
  try {
    const r = await fetch('/api/chat', {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify({ message: q })
    });
    const data = await r.json();
    if(!r.ok){
      error.textContent = "Errore API: " + (data.error || r.statusText);
      chat.textContent += "\nBot: âš ï¸ " + (data.error || r.statusText);
    }else{
      chat.textContent += "\nBot: " + (data.reply || "âš ï¸ Vuoto");
    }
  } catch(e){
    error.textContent = "Errore di rete: " + e.message;
  }
};
document.getElementById('health').onclick = async () => {
  const out = document.getElementById('out');
  out.textContent = "Eseguo test...";
  try{
    const r = await fetch('/api/health');
    const data = await r.json();
    out.textContent = JSON.stringify(data, null, 2);
  }catch(e){
    out.textContent = "Errore: " + e.message;
  }
}
</script>
</body>
</html>
